<!DOCTYPE html>
<html>
<head>
  <title>E-Cart shopping</title>
  <style>
 
 * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Header */
    header {
      background-color: #000;
      color: #fff;
      padding: 10px;
      display: flex;
      align-items: center;
    }
	
    /* LOGO */
    .logo {
      margin-right: 20px;
    }

    /* logo image */
    .logo-img {
      height: 40px; 
    }

    /* Header heading */
    .head-head {
      flex-grow: 1;
      text-align: right;
      margin-right: 10px;
      position: absolute;
      right: 0;
      margin-top: 20px;
      margin-right: 20px;
    }  
   

    /* Navigation bar */
    nav {
      background-color: #4E9781;
      color: #fff;
      padding: 10px 0;
    }

    nav ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    nav ul li {
      display: inline-block;
      margin: 0 10px;
    }

    nav ul li a {
      color: #fff;
      text-decoration: none;
    }

    nav ul li a:hover {
      color: #D7D67B; 
      text-decoration: underline; 
    }
    .logout {
      background-color: #4E9781;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
    

    .logout {
      justify-content: center;
      align-items: center;
    }
    .logout:hover{
      color: #D7D67B; 
      text-decoration: underline;
    }
    

    /* Cart page */
    .container {
      width: 70vw;
      margin: 0 auto;
      padding: 20px;
      flex-grow: 1;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .cart-items {
      margin-bottom: 20px;
    }

    .cart-item {
      display: flex;
      align-items: center;
      padding: 10px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }

    .cart-item-image {
      width: 80px;
      height: 80px;
      margin-right: 10px;
    }

    .cart-item-details {
      flex-grow: 1;
    }

    .cart-item-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .cart-item-price {
      color: #888;
      margin-bottom: 5px;
    }

    .cart-item-quantity {
      display: flex;
      align-items: center;
    }

    .quantity-label {
      margin-right: 5px;
    }

    .quantity-input {
      width: 50px;
      text-align: center;
    }

    .cart-item-total {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .remove-button {
      background-color: #FF4500;
      color: white;
      border: none;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      cursor: pointer;
      transition-duration: 0.4s;
    }

    .remove-button:hover {
      background-color: #DC143C;
    }

    .total-amount {
      text-align: right;
      font-weight: bold;
    }

    .empty-cart-message {
      text-align: center;
      margin-bottom: 20px;
    }

    .place-order-button {
      background-color: #D7D67B;
      color: #000;
      border: none;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      cursor: pointer;
      transition-duration: 0.4s;
      margin-top: 10px;
      border: 2px solid #000;
      border-radius: 3px;
    }

    .place-order-button:hover {
      background-color: #3B7B65;
    }

    /* Responsive styles */
    @media screen and (max-width: 768px) {
      .cart-item {
        flex-wrap: wrap;
      }

      .cart-item-image {
        width: 100%;
        margin-bottom: 10px;
      }

      .cart-item-details {
        flex: 0 0 100%;
      }

      .cart-item-quantity {
        justify-content: flex-end;
        margin-top: 5px;
      }

      .quantity-label {
        margin-right: 0;
        margin-left: 5px;
      }

      .quantity-input {
        width: 40px;
      }
    }

    /* Footer */
    footer {
      background-color: #4E9781;
      color: #fff;
      padding: 20px;
      text-align: center;
      margin-top: auto;
    }
    
    /* Footer links */
    .footer-links {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }
    
    .footer-links a {
      color: #fff;
      text-decoration: none;
      margin: 0 10px;
    }

    @media screen and (max-width: 768px) {
  /* Header */
  .head-head {
    text-align: center;
    position: static;
    margin-top: 0;
  }

  /* Navigation bar */
  nav ul {
    flex-direction: column;
  }

  nav ul li {
    margin: 10px 0;
  }

  /* Cart page */
  .container {
    width: 90vw;
  }

  .cart-item {
    flex-direction: column;
    align-items: center;
  }

  .cart-item-image {
    width: 100%;
  }

  .cart-item-details {
    flex: 1;
    width: 100%;
    text-align: center;
  }

  .cart-item-quantity {
    justify-content: center;
    margin-top: 10px;
  }

  .quantity-label {
    margin-right: 0;
    margin-left: 0;
  }

  .quantity-input {
    width: 60px;
  }

  .total-amount {
    text-align: center;
  }

  .empty-cart-message {
    margin-bottom: 10px;
  }

  /* Footer */
  .footer-links {
    flex-direction: column;
    align-items: center;
  }
}
  </style>
</head>
<body>

  <header>	
    <div class="logo">
    	<img src="logo.png" alt="E-Cart Shopping Logo" class="logo-img">
    </div>
    <div class="head-head">
	<h1>E-Cart Shopping</h1>
    </div>
  </header>

  <nav>
    <ul>
      <li><a href="home.html">Home</a></li>
      <li><a href="category.html">Categories</a></li>
      <li><a href="#">Cart</a></li>
      <li><button class="logout" onclick="logout()">Logout</button></li>
      <li>Welcome to the cart page <span id="username-placeholder"></span></li>
      </li>
    </ul>
  </nav>

  <div class="container">
    <h1>Your Cart</h1>

    <div class="cart-items" id="cart-items">

    </div>

    <div class="total-amount" id="total-amount">Total Amount: ₹0.00</div>

    <div class="empty-cart-message" id="empty-cart-message" style="display: none;">Your cart is empty</div>
    
    <div style="text-align: right;">   
      <button class="place-order-button" onclick="placeOrder()">Confirm Order</button>
    </div>
  </div>

<footer>
  <div class="container">
    <p>&copy; 2023 Shopping Website. All rights reserved.</p>
    <div class="footer-links">
      <a href="#">Terms of Service</a>
      <a href="#">Privacy Policy</a>
      <a href="#">Contact Us</a>
    </div>
  </div>
</footer>

  <script>

  function placeOrder() {
    window.location.href = 'razorpay.html';
  }

 fetchCartProducts();

async function fetchCartProducts() {
  const username = localStorage.getItem("username");
  if (!username) {
    console.error('Username not found in local storage.');
    return;
  }

  const apiUrl = `https://rest-api5.onrender.com/get_item/get_cart_items`;

  try {
    const response = await fetch(apiUrl, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        "Authorization": username, 
      },
    });

    if (!response.ok) {
      throw new Error('Failed to fetch cart products');
    }

    const data = await response.json();
    displayCartProducts(data.cart.products);
  } catch (error) {
    console.error('Error while fetching cart products:', error);
  }
}

    const placeholderImageUrl = 'https://example.com/placeholder-image.jpg';

function displayCartProducts(cartProducts) {
  const cartItemsContainer = document.getElementById('cart-items');
  const totalAmountElement = document.getElementById('total-amount');
  let cartTotal = 0;

  cartItemsContainer.innerHTML = ''; 

  cartProducts.forEach((cartProduct) => {
    const cartProductElement = document.createElement('div');
    cartProductElement.classList.add('cart-item');
    cartProductElement.innerHTML = `
      <img class="cart-item-image" src="${cartProduct.productImage || placeholderImageUrl}" alt="${cartProduct.productName || 'Product Name'}">
      <div class="cart-item-details">
        <div class="cart-item-name">${cartProduct.productName || 'Product Name'}</div>
        <div class="cart-item-price">₹${(cartProduct.productPrice || 0).toFixed(2)}</div>
        <div class="cart-item-quantity">
          <label class="quantity-label">Quantity:</label>
          <input class="quantity-input" type="number" value="${cartProduct.quantity || 1}" min="1" onchange="updateQuantity(this, '${cartProduct.productName}')">
        </div>
        <div class="cart-item-total">₹${((cartProduct.productPrice || 0) * (cartProduct.quantity || 1)).toFixed(2)}</div>
      </div>
      <button class="remove-button" onclick="removeItem('${cartProduct.productName}')">Remove</button>
    `;

    cartItemsContainer.appendChild(cartProductElement);

    if (cartProduct.productPrice && cartProduct.quantity) {
      cartTotal += cartProduct.productPrice * cartProduct.quantity;
    }
  });
  localStorage.setItem('cartProducts', JSON.stringify(cartProducts));
  localStorage.setItem('cartTotal', cartTotal.toFixed(2));
  totalAmountElement.textContent = `Total Amount: ₹${cartTotal.toFixed(2)}`;

  const emptyCartMessage = document.getElementById('empty-cart-message');
  emptyCartMessage.style.display = cartProducts.length === 0 ? 'block' : 'none';
}

async function updateQuantity(input, productName) {
  const quantity = parseInt(input.value, 10);

  if (isNaN(quantity) || quantity <= 0) {
    input.value = 1;
    return;
  }

  const apiUrl = `https://rest-api5.onrender.com/update_product/update_quantity_by_name`;
  const requestData = { productName, quantity };

  try {
    const response = await fetch(apiUrl, {
      method: 'PATCH', 
      headers: {
        'Content-Type': 'application/json',
        'Authorization': localStorage.getItem('jwtToken'),
        'username': localStorage.getItem('username'),
      },
      body: JSON.stringify(requestData),
    });

    if (response.ok) {
      fetchCartProducts();
    } else {
      const data = await response.json();
      console.error('Failed to update quantity:', data.error);
    }
  } catch (error) {
    console.error('Error while updating quantity:', error);
  }
}


//function for remove item from cart
async function removeItem(productName) {
  const apiUrl = `https://rest-api5.onrender.com/remove_cart/remove_cart?productName=${encodeURIComponent(productName)}`;

  try {
    const response = await fetch(apiUrl, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': localStorage.getItem('jwtToken'),
        'username': localStorage.getItem('username'),
      },
    });

    if (response.ok) {
      fetchCartProducts();
    } else {
      // Handle error responses
      const data = await response.json();
      console.error(`Failed to remove item: ${response.status} ${response.statusText}`, data.error);
    }
  } catch (error) {
    console.error('Error while removing item:', error);
  }
}


function logout() {
      localStorage.removeItem("jwtToken");

      window.location.href = "login.html";
    }

  </script>
</body>
</html>
